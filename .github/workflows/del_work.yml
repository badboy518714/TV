name: 删除 Old Workflows
on:
  schedule:
    - cron: '0 1 * * *'  # 每天午夜运行
  workflow_dispatch:
 
jobs:
  delete:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Install Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.9'

      - name: Install Requests Library
        run: python -m pip install requests

      - name: Delete Workflows
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          import requests
          import json

          headers = {
              "Authorization": f"Bearer {env['GITHUB_TOKEN']}",
              "Accept": "application/vnd.github.v3+json"
          }

          response = requests.get('https://api.github.com/repos/badboy518714/TV/actions/workflows', headers=headers)
          workflows = json.loads(response.text)['workflows']

          for workflow in Workflows:
              workflow_id = workflow['id']
              requests.delete(f'https://api.github.com/repos/badboy518714/TV/actions/workflows/{workflow_id}', headers=headers)
